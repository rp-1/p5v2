function ViewModel(){var e=this;e.places=ko.observableArray([]),e.infoWindows=[],e.infoWindow=null,e.searchString=ko.observable(),e.numRestaurants=ko.observable(0),e.map=null,e.listDropSpeed=400,e.dropdownThreshhold=480,e.infoWindowOffsetX=-130,e.infoWindowOffsetY=-150,e.lastPlaceSelected=null,e.lastZ=null,e.init=function(){window.onerror=function(){e.showErrorMsg("GENERAL ERROR")},$.ajax({type:"GET",url:"data.min.json",async:!0,dataType:"json",success:function(t){e.createMap();for(var o=0;o<t.places.length;o++){var s=t.places[o];s.isActive=ko.observable(!0),s.isSelected=ko.observable(!1);var a=new google.maps.Marker({position:s.position,name:s.name});a.image=s.image,a.setMap(e.map),a.setZIndex(o),google.maps.event.addListener(a,"click",function(t){return function(){e.placeClicked(t),e.showInfo(t)}}(s)),s.marker=a,e.places.push(s)}e.numRestaurants(e.places().length)},error:function(){e.showErrorMsg("JSON READ ERROR")}}),$("#searchbar").focus(function(){$("#places-area").height()>0&&$("#places-area").slideDown(e.listDropSpeed)})},e.placeClicked=function(t,o){e.lastZ=t.marker.getZIndex(),e.lastPlaceSelected&&(e.lastPlaceSelected.isSelected(!1),e.lastPlaceSelected.marker.setZIndex(e.lastZ)),t.isSelected(!0),t.marker.setZIndex(google.maps.Marker.MAX_ZINDEX+1),e.lastPlaceSelected=t,o&&$(window).width()<=e.dropdownThreshhold&&$("#places-area").slideUp(e.listDropSpeed),e.showInfo(t)},e.searchString.subscribe(function(t){if(e.numRestaurants(0),""!==t)for(var o=0;o<e.places().length;o++){for(var s=t.toLowerCase().trim(),a=e.places()[o].name.toLowerCase(),n=a.split(" "),r=!1,l=0;l<n.length;l++)if(n[l].substr(0,s.length)===s||a.substr(0,s.length)===s){r=!0,e.places()[o].marker.setMap(e.map),e.places()[o].isActive(!0),e.numRestaurants(e.numRestaurants()+1);break}r||(e.infoWindow&&e.infoWindow.close(),e.places()[o].isActive(!1),e.places()[o].marker.setMap(null))}else{for(var i=0;i<e.places().length;i++)e.places()[i].marker.setMap(e.map),e.places()[i].isActive(!0),e.places()[i].isSelected(!1);e.numRestaurants(e.places().length)}}),e.createMap=function(){var t={center:{lat:36.15546,lng:-86.82967},styles:[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-20}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"road.highway",elementType:"labels.icon"},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{lightness:20},{color:"#efe9e4"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{hue:"#11ff00"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#4cff00"},{saturation:58}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-10}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"simplified"}]}],zoom:12,disableDefaultUI:!0,pancontrol:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},zoomControl:!1,scaleControl:!1,streetViewControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}};e.map=new google.maps.Map(document.getElementById("map-canvas"),t),google.maps.event.addDomListener(window,"resize",function(){var t=e.map.getCenter();google.maps.event.trigger(e.map,"resize"),e.map.setCenter(t)})},e.showInfo=function(t){$(".info-window").empty(),$(".info-window-yelp").empty();var o="<div class='info-window'><h3>"+t.name+"</h3><p class='info-window-yelp-rating'></p><img class='info-window-main-img' src='"+t.image+"'><div class='info-window-yelp'>Retrieving Yelp stuff...</div></div>";e.infoWindow||(e.infoWindow=new google.maps.InfoWindow);var s=e.infoWindowOffsetX,a=e.infoWindowOffsetY;$(window).width()<=e.dropdownThreshhold&&(s=0,a-=50),e.map.setCenterWithOffset(t.marker.getPosition(),s,a),e.infoWindow.setContent(o),e.infoWindow.open(this.map,t.marker);var n=$(".info-window");e.getYelpInfo(t.yelpId,n)},e.showErrorMsg=function(e){var t="https://www.google.com/search?q=hot+chicken&ie=utf-8&oe=utf-8#q=hot+chicken+nashville",o="<h2>Something ain't right!</h2>";o+="<p>An error occurred while retrieving your hot chicken map.</p>",o+="<p>Check your connection and please try again.</p>",o+="<p>If all else fails, and you've got a serious hankering for hot chicken, try <a href='"+t+"'>searching for hot chicken on Google</a>",$("body").addClass("global-error"),$(".global-error").html(o),console.log(e)},e.getYelpInfo=function(e){var t={myConsumerKey:"b5sbMuBxHo5ZqlIJJtRxJQ",myConsumerSecret:"z3jXptGnGyBQVMconwRbnELfUaw",myAccessToken:"2iDJU47MJqKTOdO-uNXDLrtI_nrU2_pd",myAccessTokenSecret:"3_S71q7_PYycDDZoDXZoQJ2bEd8",myServiceProvider:{signatureMethod:"HMAC-SHA1"}},o="http://api.yelp.com/v2/business/"+e,s={consumerSecret:t.myConsumerSecret,tokenSecret:t.myAccessTokenSecret},a=[];a.push(["callback","yelpCallback"]),a.push(["jsonpCallback","yelpCallback"]),a.push(["oauth_consumer_key",t.myConsumerKey]),a.push(["oauth_consumer_secret",t.myConsumerSecret]),a.push(["oauth_token",t.myAccessToken]),a.push(["oauth_signature_method","HMAC-SHA1"]);var n={action:o,method:"GET",parameters:a};OAuth.setTimestampAndNonce(n),OAuth.SignatureMethod.sign(n,s);var r=OAuth.getParameterMap(n.parameters);r.oauth_signature=OAuth.percentEncode(r.oauth_signature),$.ajax({url:n.action,data:r,cache:!0,dataType:"jsonp",timeout:5e3,error:function(){$(".info-window-yelp").empty();var t="http://www.yelp.com/biz/"+e,o="Error retrieving yelp data.";o+="<p>Try visiting <a href='"+t+"'>yelp</a> to read more.</p>",$(".info-window-yelp").html(o)},success:function(e){$(".info-window-yelp").empty();for(var t="<p>",o=0;o<e.location.display_address.length;o++)t+=e.location.display_address[o],o<e.location.display_address.length-1&&(t+=", ");t+="<p>"+e.display_phone+"</p>",t+="<hr>",t+="<div class='rating-section'>",t+="<img class='rating-img' src='"+e.rating_img_url+"'>",t+="<p class='rating-text'>"+e.review_count+" reviews on Yelp</div>",t+="<h5 class='clear'>What people are saying about "+e.name+"...</h5>",t+='"'+e.snippet_text+'"',t+="<p><a href='"+e.url+"'>More from Yelp</a>",$(".info-window-yelp").html(t)}})},e.init()}google.maps.Map.prototype.setCenterWithOffset=function(e,t,o){var s=this,a=new google.maps.OverlayView;a.onAdd=function(){var a=this.getProjection(),n=a.fromLatLngToContainerPixel(e);n.x=n.x+t,n.y=n.y+o,s.setCenter(a.fromContainerPixelToLatLng(n))},a.draw=function(){},a.setMap(this)},$(document).ready(function(){ko.applyBindings(new ViewModel)});